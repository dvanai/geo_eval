name: Run GEO Pipeline

on:
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas openai

      - name: Run pipeline
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          CHATGPT_MODEL: gpt-5.2
          GEMINI_MODEL: gemini-3-flash-preview
          JUDGE_MODEL: gpt-4o
          GEO_RUNS: "1"
        run: |
          python geo_pipeline.py

      - name: Upload outputs
        uses: actions/upload-artifact@v4
        with:
          name: geo-outputs
          path: |
            high_funnel_responses.csv
            mid_funnel_responses.csv
            low_funnel_responses.csv
            all_funnel_responses.csv
            llm_table_view_combined_per_source.csv
            llm_table_view_high_per_source.csv
            llm_table_view_mid_per_source.csv
            llm_table_view_low_per_source.csv
            geo_eval_results_combined.csv
            geo_eval_results_high.csv
            geo_eval_results_mid.csv
            geo_eval_results_low.csv
            geo_eval_results_combined_summary.csv
            geo_eval_results_high_summary.csv
            geo_eval_results_mid_summary.csv
            geo_eval_results_low_summary.csv
            geo_eval_results_combined_per_run.csv
            geo_eval_results_high_per_run.csv
            geo_eval_results_mid_per_run.csv
            geo_eval_results_low_per_run.csv
            geo_response_eval_combined.csv
            geo_response_eval_high.csv
            geo_response_eval_mid.csv
            geo_response_eval_low.csv
            geo_response_eval_combined_summary.csv
            geo_response_eval_high_summary.csv
            geo_response_eval_mid_summary.csv
            geo_response_eval_low_summary.csv
            geo_response_eval_combined_per_run.csv
            geo_response_eval_high_per_run.csv
            geo_response_eval_mid_per_run.csv
            geo_response_eval_low_per_run.csv
